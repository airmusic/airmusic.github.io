var LoadingUI=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var n=(__define,t),i=n.prototype;return i.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},i.setProgress=function(e,t){this.textField.text="游戏加载中..."+e+"/"+t},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(e){function t(){e.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.onAddToStage=function(e){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},i.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.loadGroup("preload")},i.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),this.createGameScene())},i.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},i.createGameScene=function(){egret.log("create GameScene"),this.shareLoader=new egret.HttpRequest,this.shareLoader.responseType=egret.HttpResponseType.TEXT,egret.log(location.href),this.shareLoader.open("/wxdat?url="+encodeURIComponent(location.href.split("#")[0]),egret.HttpMethod.GET),this.shareLoader.send(),this.shareLoader.addEventListener(egret.Event.COMPLETE,this.onGetShareComplete,this)},i.onGetShareComplete=function(e){var t=e.currentTarget;egret.log("get data : ",t.response);var n=JSON.parse(t.response);if(n.result&&n.jssdk)if(null!=n.jssdk){var i=new BodyConfig;i.appId=n.jssdk.appId,i.timestamp=n.jssdk.timestamp,i.nonceStr=n.jssdk.nonceStr,i.signature=n.jssdk.signature,i.jsApiList=["onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","onMenuShareQZone"],i.debug=!0,egret.log(i.appId),egret.log(i.timestamp),egret.log(i.nonceStr),egret.log(i.signature),wx&&(wx.config(i),wx.ready(function(){egret.log("wx ready");var e=new BodyCheckJsAPISupport;e.jsApiList=["onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","onMenuShareQZone"],e.success(function(e){egret.log(e)}),wx.checkJsApi(e);var t={title:"玩极速优步，瓜分千万乘车券",desc:"极速优步，看看你的优步能跑多远！",link:window.location.href,imgUrl:"http://"+window.location.hostname+"/2016/q1/biz/uber_s27e01/resource/assets/icon.jpg"},n=new BodyMenuShareTimeline;n.title=t.title,n.link=t.link,n.imgUrl=t.imgUrl,n.success=function(){var e=window._czc;e&&e.push(["_trackEvent","分享朋友圈成功","share","分享",1])},n.cancel=function(){var e=window._czc;e&&e.push(["_trackEvent","分享朋友圈取消","share","分享",1])},n.fail=function(){var e=window._czc;e&&e.push(["_trackEvent","分享朋友圈失败","share","分享",1])},wx.onMenuShareTimeline(n);var i=new BodyMenuShareAppMessage;i.title=t.title,i.desc=t.desc,i.link=t.link,i.imgUrl=t.imgUrl,i.success=function(){var e=window._czc;e&&e.push(["_trackEvent","分享给朋友成功","share","分享",1])},i.cancel=function(){var e=window._czc;e&&e.push(["_trackEvent","分享给朋友取消","share","分享",1])},i.fail=function(){var e=window._czc;e&&e.push(["_trackEvent","分享给朋友失败","share","分享",1])},wx.onMenuShareAppMessage(i);var r=new BodyMenuShareQQ;r.title=t.title,r.desc=t.desc,r.link=t.link,r.imgUrl=t.imgUrl,r.success=function(){var e=window._czc;e&&e.push(["_trackEvent","分享到QQ成功","share","分享",1])},r.cancel=function(){var e=window._czc;e&&e.push(["_trackEvent","分享到QQ取消","share","分享",1])},r.fail=function(){var e=window._czc;e&&e.push(["_trackEvent","分享到QQ失败","share","分享",1])},wx.onMenuShareQQ(r);var s=new BodyMenuShareWeibo;s.title=t.title,s.desc=t.desc,s.link=t.link,s.imgUrl=t.imgUrl,s.success=function(){var e=window._czc;e&&e.push(["_trackEvent","分享到微博成功","share","分享",1])},s.cancel=function(){var e=window._czc;e&&e.push(["_trackEvent","分享到微博取消","share","分享",1])},s.fail=function(){var e=window._czc;e&&e.push(["_trackEvent","分享到微博失败","share","分享",1])},wx.onMenuShareWeibo(s)}),wx.error(function(e){egret.log(e)}))}else alert("网络错误: getWechatSign")},t}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");